<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login – Sistema Idealize</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    :root {
      --azul: #36b6ff;
      --rosa: #eb0d9f;
      --cinza-bg: #f6f8fa;
      --cinza-borda: #d0d7de;
    }
    * {
      box-sizing: border-box;
      font-family: "Helvetica Neue", Arial, sans-serif;
    }
    body {
      margin: 0;
      height: 100vh;
      overflow: hidden;
      display: flex;
      background:
        radial-gradient(circle at 20% 30%, rgba(255, 255, 255, .15) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(255, 255, 255, .12) 0%, transparent 40%),
        linear-gradient(to bottom right, #f78ac9 0%, var(--azul) 100%);
    }
    .hero {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      text-align: center;
      padding: 2rem;
    }
    .hero img {
      width: 430px;
      max-width: 80%;
    }
    .hero h1 {
      margin-top: 1.5rem;
      font-size: 2rem;
      font-weight: 600;
    }
    .panel {
      width: 100%;
      max-width: 420px;
      background: #fff;
      padding: 1.2rem 2rem 0.8rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.9rem;
      box-shadow: -4px 0 20px rgba(0, 0, 0, .05);
      overflow: auto;
      position: relative;
      justify-content: center;
      height: 100vh;
    }
    .panel img.logo {
      width: 300px;
      margin-bottom: 0.2rem;
    }
    .panel h2 {
      margin: 0 0 0.6rem 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--rosa);
    }
    .field {
      position: relative;
      width: 100%;
    }
    .field input {
      width: 100%;
      background: var(--cinza-bg);
      border: 1px solid var(--cinza-borda);
      border-radius: 6px;
      padding: 0.75rem 2.6rem 0.75rem 2.75rem;
      font-size: 1rem;
      transition: border-color .2s;
    }
    .field input:focus {
      outline: none;
      border-color: var(--azul);
      box-shadow: 0 0 0 2px rgba(54, 182, 255, .25);
    }
    .icon-left {
      position: absolute;
      left: 0.9rem;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }
    .icon-left svg {
      width: 18px;
      height: 18px;
      stroke: #6c6c6c;
    }
    .toggle-pass {
      position: absolute;
      right: 0.9rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .toggle-pass svg {
      width: 22px;
      height: 22px;
      stroke: #666;
      transition: opacity .2s;
    }
    .panel button.submit {
      width:100%;
      padding:.9rem 1rem;
      border:none;
      border-radius:6px;
      background:var(--azul);
      color:#fff;
      font-size:1rem;
      font-weight:600;
      cursor:pointer;
      transition:background .2s;
    }
    .panel button.submit:hover {
      background: #1595e6;
    }
    .panel a.forgot {
      font-size: .85rem;
      color: var(--azul);
      text-decoration: none;
      cursor: pointer;
    }
    .panel a.forgot:hover {
      text-decoration: underline;
    }
    .msg {
      font-size: .875rem;
      color: #c00;
      min-height: 18px;
      text-align: center;
    }
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.85);
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
      display: none;
      z-index: 10;
    }
    @media (max-width: 900px) {
      .hero { display: none; }
    }
    #frmLogin {
      width:100%;
      display:flex;
      flex-direction:column;
      gap:0.85rem;
    }
  </style>
</head>
<body>
  <div class="hero">
    <div>
      <img src="Vertical-Azul-SemFundo.png" alt="Idealize Saúde Logo">
      <h1>InfoSys Portal Idealize Saúde</h1>
    </div>
  </div>

  <div class="panel">
    <img src="Horizontal-Branco-SemFundo.png" class="logo" alt="Idealize Saúde">
    <h2>Acesso ao Sistema</h2>
    <div class="msg" id="msg"></div>
    <form id="frmLogin">
      <div class="field">
        <span class="icon-left">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 12c2.761 0 5-2.462 5-5.5S14.761 1 12 1 7 3.462 7 6.5 9.239 12 12 12zM3.5 23c-.276 0-.5-.196-.5-.437C3 18.253 6.134 15 10 15h4c3.866 0 7 3.253 7 7.563 0 .24-.224.437-.5.437h-17z"/></svg>
        </span>
        <input type="email" name="email" id="email" placeholder="E‑mail corporativo" required>
      </div>
      <div class="field">
        <span class="icon-left">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        </span>
        <input type="password" name="senha" id="senha" placeholder="Senha" required>
        <button type="button" class="toggle-pass" id="togglePass" aria-label="Mostrar senha">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
      </div>
      <button type="submit" class="submit">Entrar</button>
    </form>
    <a href="#" class="forgot" onclick="esqueciSenha()">Esqueci minha senha</a>
    <div class="loading" id="loading">Acessando...</div>
  </div>

<script>
const URL = 'https://script.google.com/macros/s/AKfycbzC8tQ3bTO2a69FyImqQu5WLF8Nj_y0xWzQ6oRURB1WlVHWX_bTVX-ENwvCBstEYsxE/exec';
const frm  = document.getElementById('frmLogin');
const msg  = document.getElementById('msg');
const passInput = document.getElementById('senha');
const toggleBtn = document.getElementById('togglePass');
const loading = document.getElementById('loading');
let mostrando = false;

toggleBtn.addEventListener('click', () => {
  mostrando = !mostrando;
  passInput.type = mostrando ? 'text' : 'password';
  toggleBtn.querySelector('svg').style.opacity = mostrando ? 0.4 : 1;
});

frm.addEventListener('submit', async (e) => {
  e.preventDefault();
  msg.textContent = '';
  loading.style.display = 'block';

  const fd = new FormData(frm);
  fd.append('action', 'login');

  try {
    const r   = await fetch(URL, { method: 'POST', body: fd });
    const txt = await r.text();
    loading.style.display = 'none';
    if (txt.startsWith('{')) {
      const data = JSON.parse(txt);
      localStorage.setItem('token', data.token);
      localStorage.setItem('nivel', data.nivel);
      window.location = data.precisaTrocar ? 'alterar-senha.html' : 'infosys_dashboard.html';
    } else {
      msg.textContent = txt.replace(/_/g, ' ');
    }
  } catch (err) {
    loading.style.display = 'none';
    msg.textContent = 'Erro de rede';
  }
});

async function esqueciSenha() {
  const email = document.getElementById("email").value.trim();
  if (!email) {
    alert("Por favor, preencha o campo de e-mail para continuar.");
    return;
  }

  const ip = await obterIP();
  const params = new URLSearchParams({
    action: "esqueci",
    email,
    ip
  });

  try {
    const res = await fetch(URL, { method: "POST", body: params });
    const resposta = await res.text();

    switch (resposta) {
      case "ENVIADO":
        alert("Uma nova senha foi enviada para o seu e-mail.");
        break;
      case "LIMITE_EXCEDIDO":
        alert("Você excedeu o número de tentativas. Tente novamente mais tarde.");
        break;
      case "EMAIL_NAO_ENCONTRADO":
        alert("E-mail não encontrado na base de dados.");
        break;
      default:
        alert("Erro: " + resposta);
    }
  } catch (erro) {
    alert("Erro de rede. Tente novamente.");
  }
}

async function obterIP() {
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    const data = await res.json();
    return data.ip || "desconhecido";
  } catch {
    return "desconhecido";
  }
}
</script>
</body>
</html>
