<!doctype html><meta charset="utf-8">
<title>Trocar Senha – InfoSys</title>
<style>
  body{
    font-family:Arial,Helvetica,sans-serif;
    display:flex;justify-content:center;align-items:center;
    height:100vh;margin:0;background:#f6f8fa;
  }
  .card{
    background:#fff;padding:2rem 2.5rem;border:1px solid #d0d7de;
    border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.05);
    width:100%;max-width:400px;text-align:center
  }
  input{width:100%;padding:.75rem;border:1px solid #d0d7de;
        border-radius:6px;font-size:1rem;margin:.75rem 0}
  button{width:100%;padding:.8rem;border:none;border-radius:6px;
         background:#36b6ff;color:#fff;font-weight:600;font-size:1rem;
         cursor:pointer}
  .msg{height:18px;font-size:.9rem;margin-top:.3rem;color:#c00}
</style>

<div class="card">
  <h2>Defina sua nova senha</h2>
  <form id="f">
    <input type="password" id="nova" placeholder="Nova senha" required minlength="8">
    <input type="password" id="conf" placeholder="Confirmar senha" required>
    <button>Salvar</button>
    <div class="msg" id="msg"></div>
  </form>
</div>

<script>
const URL = 'https://script.google.com/macros/s/AKfycbzC8tQ3bTO2a69FyImqQu5WLF8Nj_y0xWzQ6oRURB1WlVHWX_bTVX-ENwvCBstEYsxE/exec';

if(!localStorage.getItem('token')) location='index.html';

const f   = document.getElementById('f');
const msg = document.getElementById('msg');

f.addEventListener('submit', async e=>{
  e.preventDefault();
  msg.textContent='';
  const nova=document.getElementById('nova').value.trim();
  const conf=document.getElementById('conf').value.trim();
  if(nova!==conf){ msg.textContent='Senhas não coincidem'; return; }

  const fd=new FormData();
  fd.append('action','trocar');
  fd.append('token',localStorage.getItem('token'));
  fd.append('nova',nova);

  try{
    const r = await fetch(URL,{method:'POST',body:fd});
    const t = await r.text();
    if(t==='OK'){
      alert('Senha alterada! Faça login novamente.');
      localStorage.clear();
      location='index.html';
    }else{
      msg.textContent=t.replace(/_/g,' ');
    }
  }catch{
    msg.textContent='Erro de rede';
  }
});
</script>
